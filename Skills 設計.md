# 🕵️‍♂️ 頂級 Agent Skills 深度分析與診斷協定 (Pro Version)

> 目標：請你作為「這個專案的技術總監」，不要直接提出方案，而是先完成一份可用來設計 Agent Skills 的診斷報告。

> 注意：
> - 不要直接給出具體 Skill 名稱
> - 只描述「需要什麼類型的能力 / 功能」
> - 可以假設你能讀取目前專案目錄下的所有檔案

---

## 🛠 第一階段：全域上下文解構 (Deep Context Extraction)

請先完成專案結構與現況分析，只輸出分析結果，不要做任何建議。

### 1. 專案圖譜掃描

1.1 請根據專案檔案樹（等同於執行 `ls -R` 或 `tree` 的結果）進行分類，標註出：
- 核心模組（Core / Domain / Model 層）
- 介面層（API / Controller / UI / View 層）
- 工具類（Utils / Helpers / Library）
- 配置檔（Config / .env / 設定檔）

1.2 找出**程式碼行數最多或邏輯密度最高的 3 個檔案**，並對每個檔案說明：
- 檔案路徑
- 它主要處理什麼邏輯
- 為什麼你認為它是「邏輯密度高」或「風險集中」的部分

### 2. 技術債與重複模式偵測

2.1 在專案中找出「模式高度相似」的程式碼區塊，例如：
- 重複的 CRUD 邏輯
- 類似的資料驗證流程
- 重複的錯誤處理樣板

對每一類重複模式，請說明：
- 代表性檔案與行為
- 這些模式通常在什麼情境被呼叫

2.2 識別「高度依賴外部文檔」的區域，例如：
- 依賴第三方 API（需要查 Docs 才能正確呼叫）
- 依賴公司內部規範（如：特殊代碼規則、欄位對照表）

請列出：
- 檔案路徑
- 外部依賴類型（第三方 API / 內部規範 / 法規等）
- 為什麼你判斷這裡強烈依賴外部文檔

### 3. 現有 Skill 盤點 (Inventory)

如果專案中存在與 Agent Skills 相關的內容（任一項即可）：
- `.skills/` 目錄
- `SKILL.md`
- 任何 `skills.*` 設定檔

請列出：
- 檔案路徑
- 每個 Skill 的「職責覆蓋範圍」：它主要解決什麼問題？屬於哪個開發階段（開發 / 測試 / 部署 / 營運）？

如果完全沒有相關檔案，請明確標註「未發現既有 Skills」。

---

## 🧠 第二階段：多維度需求推導 (Multidimensional Inference)

在這一階段，請**基於第一階段的發現**，推導「需要哪些能力」，仍然不要給出 Skill 名稱，只用**功能描述 + 證據**。

### 4. 工程效率維度

說明哪些任務佔用了開發者最多的手動時間，例如：
- 反覆調整環境設定
- 建立或更新模擬測試資料
- 針對類似結構撰寫重複的 CRUD / 驗證程式碼

請對每一類任務說明：
- 對應的檔案或模組範圍
- 這項工作具體在做什麼
- 為什麼你判斷它是「高頻、耗時」

### 5. 品質守門員維度

找出那些：
- 極易出錯
- 靜態檢查難以完全覆蓋
- 靠人工 review 容易漏掉

的邏輯區域，例如：
- 多階段狀態機（Order 狀態流轉、工作流程引擎）
- 跟金額、數量、時間計算強相關的邏輯
- 涉及多種例外情況與邊界條件的流程

請對每一類區域說明：
- 文件/程式碼位置
- 出錯會造成什麼後果（例如：金額錯誤、權限錯誤、資料遺失）
- 為什麼不容易只靠 Lint / Type 檢查發現

### 6. 知識封裝維度

說明哪些「特定領域知識」是開發這個專案時必備的，例如：
- 特殊的財務/稅務演算法
- 某公司或組織的內部編碼規範
- 特定產業標準（醫療、金融、物流等）

對每一項知識封裝需求，請描述：
- 它出現在哪些檔案或模組
- 如果 AI 不懂這個領域，會犯下哪些典型錯誤
- 這類知識是否來自外部文件（規格書、條款、操作手冊）

---

## 🎯 第三階段：Agent Skills 結構化提案 (Structured Proposal)

現在請根據上述診斷結果，設計 **3～5 個「理想中的 Skills」**。  
注意：這裡的「Skill 名稱」是設計目標，不是現有 Skill，仍然不需要對應到任何實際倉庫。

### 每個 Skill 請使用以下規格書格式：

#### 🏷 Skill 名稱：[精準描述唯一職責的名稱]

- **需求來源 (Evidence)**：  
  - 指出是根據哪些檔案 / 模組 / 重複模式 / 風險點推導出來的  
  - 範例格式：  
    - 來自 `src/api/order/*.ts` 中重複的狀態轉換邏輯  
    - 來自 `services/payment/*.py` 中多處使用相同費率計算公式

- **核心職責 (Core Responsibility)**：  
  用 2～4 句清楚說明：  
  這個 Skill 在 Agent 系統裡「只負責哪一類具體工作」，例如：  
  - 「解析並檢查訂單狀態流轉是否符合規格書中的狀態圖」  
  - 「根據內部費率表，檢查所有金額計算是否使用正確欄位與公式」

- **漸進式加載策略 (Progressive Loading Strategy)**：

  - **Level 1（Trigger）**：  
    - 列出 2～4 種會觸發這個 Skill 的具體場景或關鍵字，例如：  
      - 當 Agent 需要修改與「訂單狀態」相關的程式碼時  
      - 當使用者詢問「某一筆金額計算是否合法」時

  - **Level 2（Instruction / SKILL.md 應包含的三個關鍵步驟）**：  
    請具體列出三個主要步驟，例如：  
    1. 從對應檔案讀取目前的邏輯實作與參數  
    2. 對照（某份規格 / 規則）檢查必要條件與邊界情況是否被涵蓋  
    3. 產生具體的修改建議或標記出不符合規則的程式碼位置

  - **Level 3（Execution / 輔助腳本建議）**：  
    - 說明這個 Skill 理想上可以附帶哪些腳本或工具，例如：  
      - `python check_state_machine.py`：輸入檔案路徑，輸出不合法狀態轉換清單  
      - `node generate_mock_orders.mjs`：生成符合特定邊界條件的測試訂單資料

- **預期效益**：  
  用具體的說法估算效益，例如：  
  - 「預計可以減少 70% 以上針對訂單狀態錯誤的人工除錯對話」  
  - 「預計可以將重複撰寫 CRUD 相關程式的時間縮短一半」

---

## 📊 第四階段：優先級與可行性矩陣 (Priority Matrix)

請為上一節提出的每個 Skill，建立一個表格，格式如下：

| Skill 提案名稱 | 實作難度 (1-5) | 使用頻率 / 價值 (1-5) | 優先級 (P0/P1/P2) | 核心理由（具體到場景） |
| -------------- | --------------- | ---------------------- | ------------------ | ------------------------ |
| 範例：API 格式校驗器 | 2 | 5 | P0 | 目前 `api/` 目錄下的 JSON schema 經常變動，人工比對文件與實作時容易遺漏欄位或型別不符。 |

請確保：
- 「實作難度」是基於實際需要撰寫多少檢查邏輯、是否需要額外工具來評估
- 「使用頻率 / 價值」結合你在專案中觀察到的實際發生頻率與出錯成本
- 「核心理由」必須具體，例如指向某類錯誤、某個目錄、某種日常作業，而不是抽象的「可以提升品質」

---

## 📝 輸出限制與品質自檢

1. 禁用模糊詞彙：  
   - 不要只寫「優化」、「改進」、「加強測試」這類模糊說法  
   - 改用具體描述，例如：  
     - 「減少重複撰寫 [資料庫 CRUD 函式] 的時間」  
     - 「自動檢查 [React Hooks] 是否遵守規則（如依賴陣列正確性）」  

2. 自檢問題（請在回答最後明確回答「是 / 否」）：  
   > 「如果我是這個專案的負責人，我是否能根據這份診斷與提案，**直接著手編寫這些 Skills**，而不需要再追問你？」  

   如果答案是否，請補充你認為缺少的關鍵資訊，然後再結束輸出。
